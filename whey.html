<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Whey Protein | Coreano Suplementos</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="navbar">
    <div>
      <a href="index.html">In√≠cio</a>
      <a href="produtos.html">Produtos</a>
      <a href="#">Contato</a>
      <span class="cart-icon" id="cart-icon">
        <span class="emoji-cart">üõí</span>
        <span class="quantidade-carrinho" id="quantidade-carrinho">0</span>
      </span>
    </div>
  </div>

  <main class="produtos-container">
    <h2>Whey Protein</h2>
    <div class="produtos-grid" id="produtos-lista"></div>
  </main>

  <!-- Modal de fundo (backdrop) -->
  <div id="backdrop-modal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.6); z-index: 999; display: none;"></div>

  <!-- Modal do carrinho -->
  <div id="modal-carrinho" class="modal-carrinho" style="display:none;">
    <h3>Seu Carrinho</h3>
    <div id="itens-carrinho"></div>
    <div class="resumo-pedido">
      <h4>Resumo do Pedido</h4>
      <ul id="lista-resumo"></ul>
      <p><strong>Total: R$ <span id="total-pedido">0,00</span></strong></p>
      <button class="btn-finalizar" onclick="finalizarCompraCarrinho()">Finalizar Compra no WhatsApp</button>
      <button onclick="limparCarrinho()" style="margin-top: 0.5rem; background-color: #f44336; color: white; width: 100%; border: none; padding: 0.75rem; border-radius: 8px; font-weight: bold;">ü™ü Limpar Carrinho</button>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Coreano Suplementos. Todos os direitos reservados.</p>
  </footer>

  <!-- Scripts -->

  <script src="js/carrinho.js"></script>
  <script src="js/script.js"></script> 
  <script src="js/produtos.js"></script> 
  
<script>


  document.addEventListener("DOMContentLoaded", () => {
    // Certifique-se de que a lista de produtos seja carregada corretamente
    console.log("Carregando a p√°gina...");
    const lista = document.getElementById("produtos-lista");
    
    // Categoria 'whey' ou qualquer outra categoria
    const categoriaAtual = "whey";

    // Carrega os produtos armazenados no localStorage
    const produtosSalvos = JSON.parse(localStorage.getItem("produtos")) || [];
    
    // Filtra os produtos da categoria 'whey'
    const produtosFiltrados = produtosSalvos.filter(p => p.categoria === categoriaAtual);

    // Caso n√£o haja produtos da categoria 'whey'
    if (produtosFiltrados.length === 0) {
      lista.innerHTML = "<p>Em breve voc√™ ver√° nossos produtos dessa categoria aqui kkkk.</p>";
    } else {
      // Exibe os produtos filtrados na tela
      produtosFiltrados.forEach((produto) => {
        const card = document.createElement("div");
        card.className = "produto-card";

        card.innerHTML = `
          <img src="${produto.imagem}" alt="${produto.nome}" />
          <h3>${produto.nome}</h3>
          <p>R$${parseFloat(produto.preco).toFixed(2)}</p>
          <button onclick='abrirModalProduto(event, ${JSON.stringify(produto)})'>Comprar</button>
        `;

        lista.appendChild(card);
      });
    }
  });

  // Fun√ß√£o para abrir o modal do produto ao clicar no bot√£o "Comprar"
  function abrirModalProduto(event, produto) {
    const modal = document.createElement("div");
    modal.classList.add("mini-modal");

    let saboresHTML = "";
    if (produto.temSabores === "sim" && produto.sabores?.length > 0) {
      saboresHTML = `
        <div class="sabor-box">
          <h4>Sabor</h4>
          <select class="sabor-select">
            ${produto.sabores.map(s => `<option value="${s}">${s}</option>`).join("")}
          </select>
        </div>
      `;
    }

    modal.innerHTML = `
      <img src="${produto.imagem}" alt="${produto.nome}" style="max-width: 140px; margin-bottom: 0.5rem;" />
      <h3 style="font-size: 1rem; margin-bottom: 0.5rem;">${produto.nome}</h3>
      <p style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.5rem;">R$ ${parseFloat(produto.preco).toFixed(2)}</p>
      ${saboresHTML}
      <div style="display: flex; gap: 0.5rem; margin-top: 0.8rem; justify-content: center;">
        <button class="btn-ver-produtos" onclick='confirmarCompraDireta(this, ${JSON.stringify(produto)})'>Adicionar ao Carrinho</button>
        <button onclick="fecharModal()">Fechar</button>
      </div>
    `;

    modal.style.position = "fixed";
    modal.style.top = "50%";
    modal.style.left = "50%";
    modal.style.transform = "translate(-50%, -50%)"; // Centraliza o modal
    modal.style.zIndex = "1000"; // Fica por cima de outros elementos
    modal.style.backgroundColor = "#fff";
    modal.style.borderRadius = "12px";
    modal.style.padding = "1.5rem";
    modal.style.boxShadow = "0 4px 12px rgba(0,0,0,0.3)";
    modal.style.textAlign = "center";

    document.body.appendChild(modal);
    document.getElementById("backdrop-modal").classList.add("active"); // Ativa o fundo escuro
  }

  // Fun√ß√£o para fechar o modal
  function fecharModal() {
    const modal = document.querySelector(".mini-modal");
    if (modal) modal.remove();
    document.getElementById("backdrop-modal").classList.remove("active"); // Remove o fundo escuro
  }

  // Fun√ß√£o para adicionar ao carrinho
  function confirmarCompraDireta(botao, produto) {
    let nomeFinal = produto.nome;
    const saborSelect = botao.closest(".mini-modal").querySelector(".sabor-select");
    if (saborSelect) {
      nomeFinal += ` - ${saborSelect.value}`;
    }

    adicionarCarrinhoDinamico(produto.id, nomeFinal, produto.preco);
    fecharModal();
  }


    // Fun√ß√£o para abrir o carrinho ao clicar no √≠cone
    const cartIcon = document.getElementById("cart-icon");
    const modalCarrinho = document.getElementById("modal-carrinho");
    const backdropModal = document.getElementById("backdrop-modal");

    if (cartIcon && modalCarrinho) {
      cartIcon.addEventListener("click", () => {
        if (modalCarrinho.style.display === "block") {
          modalCarrinho.style.display = "none"; // Fecha o modal
          backdropModal.classList.remove("active"); // Remove o fundo escuro
        } else {
          carregarCarrinho(); // Carrega os itens do carrinho
          modalCarrinho.style.display = "block"; // Exibe o carrinho
          backdropModal.classList.add("active"); // Exibe o fundo escuro
        }
      });
    }

    // Fechar o modal quando clicar fora do modal
    window.addEventListener("click", (event) => {
      if (event.target === backdropModal) { 
        modalCarrinho.style.display = "none"; // Fecha o modal do carrinho
        backdropModal.classList.remove("active"); // Remove o fundo escuro
      }
    });

    // Fun√ß√£o para carregar os itens no carrinho
    function carregarCarrinho() {
      const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      const container = document.getElementById("itens-carrinho");
      const resumo = document.getElementById("lista-resumo");
      const totalSpan = document.getElementById("total-pedido");

      container.innerHTML = "";
      resumo.innerHTML = "";

      const agrupado = {};
      carrinho.forEach((item) => {
        const key = `${item.nome}|${item.preco}`;
        if (!agrupado[key]) {
          agrupado[key] = { ...item, quantidade: 1 };
        } else {
          agrupado[key].quantidade += 1;
        }
      });

      let total = 0;
      Object.keys(agrupado).forEach((key) => {
        const item = agrupado[key];
        const precoTotal = parseFloat(item.preco) * item.quantidade;
        total += precoTotal;

        const div = document.createElement("div");
        div.classList.add("carrinho-item");
        div.innerHTML = `
          <strong>${item.nome}</strong> (x${item.quantidade}) - R$ ${precoTotal.toFixed(2)}
          <button onclick="removerTodosDoMesmoProduto('${key}')">üóëÔ∏è</button>
        `;
        container.appendChild(div);

        const li = document.createElement("li");
        li.textContent = `${item.nome} (x${item.quantidade}) - R$ ${precoTotal.toFixed(2)}`;
        resumo.appendChild(li);
      });

      totalSpan.innerText = total.toFixed(2);
    }

    // Fun√ß√£o de Finalizar Compra
    function finalizarCompraCarrinho() {
      const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      
      if (carrinho.length === 0) {
        alert("Seu carrinho est√° vazio!");
        return;
      }

      const mensagem = carrinho.map(item => `${item.nome} - R$ ${item.preco}`).join('\n');
      const total = carrinho.reduce((acc, item) => acc + parseFloat(item.preco), 0).toFixed(2);

      const texto = `Ol√°! Gostaria de comprar os seguintes produtos:\n\n${mensagem}\n\nTotal: R$ ${total}`;
      const url = `https://wa.me/5561985402592?text=${encodeURIComponent(texto)}`;
      window.open(url, '_blank');
    }

    // Fun√ß√£o para Limpar o Carrinho
    function limparCarrinho() {
      if (confirm("Tem certeza que deseja remover todos os itens do carrinho?")) {
        localStorage.removeItem("carrinho");
        carregarCarrinho();
        atualizarQuantidadeCarrinho();
      }
    }
  </script>
</body>
</html>
